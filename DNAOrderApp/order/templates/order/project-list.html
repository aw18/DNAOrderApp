{% extends "base_template.html" %} 

{% block title %}Project List{% endblock title %}


{% block extra_css_js %}
<link href="{{ STATIC_URL }}bootstrap-modal/css/bootstrap-modal.css" rel="stylesheet" media="screen">
<link href="{{ STATIC_URL }}bootstrap-modal/js/bootstrap-modalmanager.js" rel="text/javascript" media="screen">
<link href="{{ STATIC_URL }}bootstrap-modal/js/bootstrap-modal.js" rel="text/javascript" media="screen">

<script src="http://malsup.github.io/jquery.form.js"></script> 

<script type="text/javascript">
	$().ready(function() {
		// alert("Testing");
		// $('#hello').text("The DOM is now loaded and can be manipulated.");
		// $('#upload_manifest form').each(function(i, j) { alert(j); });

		// prepares a form to be submitted via AJAX 
		// $('#upload_manifest form').ajaxForm({
		// 	//target: '#recent_document',
		// 	success: function(body) {
		// 		alert("this is from ajaxForm: " + body);
		// 		//$('#upload_manifest > .modal-body').
		// 	}
		// });

		$('#save-button').click(function () {
			$(this).ajaxSubmit({ 
				resetForm: true,
				success: function () {
					alert("You have saved the project");
					$('#myModalLabel_add_project').html("Thank you for your Submission!");

					$('#upload_manifest_form').html("<p><b> You have uploaded and saved the following manifest into the database: </b></p><!-- List of uploaded documents --><div id='recent_document'>{% if recent_document %}<ul><li><a href='{{ recent_document.docfile.url }}''>{{ recent_document.docfile.name }}</a></li><br /><br />{{ display_dict }}</ul>{% else %}<p>No documents.</p>{% endif %}</div>");

					$('#upload_manifest_modal_footer').html("<button id='upload_manifest_close_button' class='btn' data-dismiss='modal' aria-hidden='true'>Close</button>");

				},
				error: function () {
					$('#myModalLabel_add_project').html("Sorry, There's been an error.");
					$('#upload_manifest_form').html("<p><b> The following manifest failed to be submitted. Please Try Again. </b></p><!-- List of uploaded documents --><div id='recent_document'>{% if recent_document %}<ul><li><a href='{{ recent_document.docfile.url }}''>{{ recent_document.docfile.name }}</a></li><br /><br />{{ display_dict }}</ul>{% else %}<p>No documents.</p>{% endif %}</div>");

					$('#upload_manifest_modal_footer').html("<button id='upload_manifest_close_button' class='btn' data-dismiss='modal' aria-hidden='true' href='project-list.html'>Close</button>");
				}
			});
			return false;
		});
		
		
		$('#upload_manifest').on('hide', function(){
			alert("closing modal");
			window.location.href="project-list"

		});
   

						// 	<!-- List of uploaded documents -->
						// 	<div id="recent_document">
						// 		{% if recent_document %}
						// 		<ul>
						// 			<li><a href="{{ recent_document.docfile.url }}">{{ recent_document.docfile.name }}</a></li>
						// 			<br />
						// 			<br />
						// 		{{ display_dict }}
						// 		</ul>
						// 		{% else %}
						// 		<p>No documents.</p>
						// 		{% endif %}
						// 	</div>

		// submits the form immediately after 'submit' button is pressed
		// attach handler to form's submit event
		// $('#upload_manifest form').submit(function() {
		// 	//submit the form
		// 	$(this).ajaxSubmit({ 
		// 		target: '#recent_document', 
		// 		success: function() {
		// 			alert("Thank you for uploading your manifest :)");

		// 		} 
		// 	});
		// 	// file's been chosen
		// 	// show the document as uploaded
		// 	// then show what's been extracted

		// 	// Then another function will need to be set for the "Save Changes" button

		// 	// return false to prevent normal browser submit and page navigation
		// 	return false;
		// });
		// $('#save-button').click(function () {
		// 	$(this).ajaxSubmit({ success: function () {
		// 		alert("You have saved the project");
		// 	}});
		// 	return false;
  //   	});
	});
</script>

{% endblock extra_css_js %}

{% block active-navbar %} 
<li><a href="index">Home</a></li>
<li><a href="about">About</a></li>
<li><a href="contact">Contact</a></li>
<li class="active"><a href="project-list">Project List</a></li>
{% endblock active-navbar %}

{% block content %}

{% block section_title %}<h1> Project List </h1>{% endblock section_title %}

<p id="hello">Not loaded yet.</p>

<table class="table table-hover">
	<tr>
		<th> Manifest Name </th>
		<th> No. Plate </th>
		<th> Study </th>
		<th> Supplier </th>
		<th> Created On </th>
		<th> Created by </th>
		<!-- Select Phenotypes, View Phenotypes -->
		<th> Phenotype List </th>
		<!--Incomplete Manifest, Failed Upload, Pending for Collaborators, Complete, Incomplete Phenotype list -->
		<th> Status Of Order </th> 
	</tr>
	<tr>
		<td> Dummy Data - Manifest_1210 </td>
		<td> 3 </td>
		<td> UK10K_CILWGA </td>
		<td> University College London Medical School </td>
		<td> April 5, 2013 </td>
		<td> aw18 </td>
		<td> <a href="pheno_select"> Select Phenotypes </a></td>
		<td> Incomplete Phenotype List </td>
	</tr>
	<tr>
		<td> Dummy Data 2 - Manifest_1369 </td>
		<td> 1 </td>
		<td> 2019STDY </td>
		<td> Sanger Centre </td>
		<td> May 9, 2013 </td>
		<td> aw18 </td>
		<td> <a href="pheno-list"> View Phenotype List </a></td>
		<td> <a href="welcome-collaborator"> Start Well-filling </a></td>
	</tr>
</table>

<!-- Button to trigger modal -->
<a href="#upload_manifest" role="button" class="btn" data-toggle="modal" data-keyboard=true>
	<i class="icon-plus"></i>
</a>
<a href="#delete_project" role="button" class="btn" data-toggle="modal" data-keyboard=true>	<i class="icon-minus"></i>
</a>

<!-- Upload Modal -->
<div id="upload_manifest" class="modal container hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-header">
		<button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>
		<h3 id="myModalLabel_add_project">Add A Project</h3>
	</div>

	<div id="upload_manifest_form" class="modal-body">
		<h4> Upload the Manifest </h4>

		<!-- Upload form. Note enctype attribute! -->
		<form action="{% url project-list %}" method="post" enctype="multipart/form-data">
			{% csrf_token %}

			<p>{{ form.non_field_errors }}</p>

			<!-- form.docfile.label_tag is the field's label wrapped in the appropriate "label" tag  i.e. <label for="id_email"> E-mail address 
		    </label> -->
		    <p>{{ form.docfile.label_tag }} {{ form.docfile.help_text }}</p>
		    <p>
		    	{{ form.docfile.errors }}
		    	{{ form.docfile }}
		    </p>
		</form>

		<h4> The following is what's extracted from the manifest: </h4>
		<p> Study Name, Supplier Name, Sanger Plate IDs, Sanger Sample IDs </p>

	</div>
	<div id="upload_manifest_modal_footer" class="modal-footer">
		<button id="upload_manifest_close_button" class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
		<button id="save-button" class="btn btn-primary" data-loading-text="Extracting columns..." data-complete-text="finished!" >Upload and Save File! </button>
	</div>
</div>

<!-- Delete Modal -->
<div id="delete_project" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-header">
		<button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
		<h3 id="myModalLabel">Deleting project</h3>
	</div>
	<div class="modal-body">
		<p>Are you sure you want to delete this project?</p>
	</div>
	<div class="modal-footer">
		<button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
		<button class="btn" data-dismiss="modal" aria-hidden="true">Delete project</button>
	</div>
</div>

<br>
<br>

{% endblock content %}

<!-- {% include "manifest_upload.html" %}

{% block add_file %}
{% endblock add_file %}

{% block delete_file %}
{% endblock delete_file %} -->
